#!/usr/bin/env bash
set -euo pipefail

# TEST: MUST DIE CLEANLY
# Verifies that when CORPIFORM is declared DEAD, no execution is possible
# and no authority is consumed.

# Mark system as DEAD
echo "DEAD" > STATUS.md

export EXECUTION_COMMAND_PATH="fixtures/valid_authority/command.json"
export AUTHORITY_SEAL_PATH="fixtures/valid_authority/seal.json"
export EXECUTION_CUSTODIAN="test-custodian"
export SYSTEM_FINGERPRINT="test-fingerprint"
export BUILD_HASH="test-build-hash"
export CORPIFORM_VERSION="v0.test"

# Execution MUST be refused
if runtime/runner/run.sh >/dev/null 2>&1; then
  echo "FAIL: execution succeeded while system was DEAD"
  exit 1
fi

echo "PASS: system refused execution while DEAD"

# Cleanup for test isolation
echo "ALIVE" > STATUS.md

exit 0
